<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to SpatialOmicsOverlay • SpatialOmicsOverlayWorkshop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to SpatialOmicsOverlay">
<meta property="og:description" content="SpatialOmicsOverlayWorkshop">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SpatialOmicsOverlayWorkshop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction-to-SOO.html">Introduction to SpatialOmicsOverlay</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nanostring-biostats/SOOBiocWorkshop" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://ghcr.io/nanostring-biostats/soobiocworkshop:latest" class="external-link">
    <span class="fab fa-docker"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to SpatialOmicsOverlay</h1>
                        <h4 data-toc-skip class="author">Maddy Griswold,
Megan Vandenberg, and Stephanie Zimmerman<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nanostring-biostats/SOOBiocWorkshop/blob/HEAD/vignettes/Introduction-to-SOO.Rmd" class="external-link"><code>vignettes/Introduction-to-SOO.Rmd</code></a></small>
      <div class="hidden name"><code>Introduction-to-SOO.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>With GeoMx DSP, regions of interest (ROIs) are selected by the user
and then molecularly profiled within each ROI.
<code>SpatialOmicsOverlay</code> was specifically made to visualize and
analyze the free-handed nature of Region of Interest (ROI) selection in
a GeoMx experiment, and the immunofluorescence-guided segmentation
process. ROIs can be either profiled in the selected area (i.e.,
geometric profiling) or subdivided based on the visible morphology
markers into compartments and profiled separately (i.e., segmented
profiling). Probe counts collected from ROIs underly the genomic
expression signal. The overlay from the instrument is recreated in the R
environment, allowing for plotting overlays with data like ROI type or
gene expression.</p>
<p>This vignette demonstrates how to use OME-TIFF image files generated
by the NanoString <a href="https://nanostring.com/products/geomx-digital-spatial-profiler/geomx-dsp-overview/" class="external-link">GeoMx
<sup>®</sup> Digital Spatial Profiler (DSP)</a> instrument to enhance
data visualization of your experiments. You will use as a case study one
sample of mouse brain. We will be walking through how to plot the image,
profiled regions, and their gene expression.</p>
<p>The SpatialOmicsOverlay package is <a href="https://bioconductor.org/packages/release/bioc/html/SpatialOmicsOverlay.html" class="external-link">now
available</a> through Bioconductor.</p>
<p><em>Note: Many of the later code chunks have
<code>eval=FALSE</code>–work through the vignette yourself to see the
images and plots!</em></p>
</div>
<div class="section level2">
<h2 id="about-this-sample">About This Sample<a class="anchor" aria-label="anchor" href="#about-this-sample"></a>
</h2>
<p>The mouse brain sample in this vignette is one of <a href="https://nanostring.com/products/geomx-digital-spatial-profiler/spatial-organ-atlas/mouse-brain/" class="external-link">four
available</a> from our <a href="https://nanostring.com/products/geomx-digital-spatial-profiler/spatial-organ-atlas/mouse-brain/" class="external-link">Spatial
Organ Atlas</a>. While we will be looking at only one sample, any of the
data from our freely-downloadable Spatial Organ Atlas samples would also
suffice as an alternative.</p>
<div class="figure">
<img src="4channels.png" alt="Mouse brain" width="50%"><p class="caption">
Mouse brain
</p>
</div>
<p>This coronal section of formalin-fixed, paraffin-embedded (FFPE)
adult mouse was visualized with antibodies to:</p>
<ul>
<li>NeuN (neuronal nuclei and perinuclear cytoplasm)</li>
<li>GFAP (astrocytes)</li>
<li>Iba1 (microglia)</li>
<li>SYTO83 (nuclei)</li>
</ul>
<p>This mouse brain features both geometric and segmented ROI profiling.
For the segmented profiling, we mainly used NeuN as a morphology marker
to segment the neuronal nuclei and neuropil regions on this sample:</p>
<ul>
<li>Neuronal nuclei - NeuN+</li>
<li>Neuropil - NeuN-</li>
</ul>
</div>
<div class="section level2">
<h2 id="load-libraries">Load Libraries<a class="anchor" aria-label="anchor" href="#load-libraries"></a>
</h2>
<p><strong><em>Note: We have occasionally observed this error when
running <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library(SpatialOmicsOverlay)</a></code>, which has
<code>RBioFormats</code> as a dependency:</em></strong></p>
<pre><code>Error: package or namespace load failed for 'SpatialOmicsOverlay':
  .onLoad failed in loadNamespace() for 'RBioFormats', details:
  call: jclassName(class, class.loader = class.loader)
  error: java.lang.ClassNotFoundException</code></pre>
<p><strong><em>We theorize this is due to the Dockerized RStudio warming
up and downloading the cached RBioFormats jar file, launching the JVM,
or other initiating processes. If you are encountering this error, we
recommend waiting several minutes between logging into RStudio and
running this vignette. We have also had success in repeatedly restarting
R (not RStudio) and running the <code>Load Libraries</code> chunk again.
If the issue persists, you may consider generating a new container from
the Docker image. Finally, it may be helpful to wait until the
RBioFormats cached jar file is fully in place before loading
SpatialOmicsOverlay; see the following code chunk.</em></strong></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fn &lt;- "~/.cache/R/RBioFormats/bioformats_package_6.12.0.jar"</span></span>
<span><span class="co"># file.exists(fn, recursive =TRUE)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># if (file.exists(fn)) {</span></span>
<span><span class="co">#   print(file.info(fn)$size)</span></span>
<span><span class="co">#   if(file.info(fn)$size == 43081858) {</span></span>
<span><span class="co">#     library(SpatialOmicsOverlay)</span></span>
<span><span class="co">#   }</span></span>
<span><span class="co"># }</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SpatialOmicsOverlay</span><span class="op">)</span></span>
<span><span class="co">#&gt; Registered S3 method overwritten by 'GGally':</span></span>
<span><span class="co">#&gt;   method from   </span></span>
<span><span class="co">#&gt;   +.gg   ggplot2</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">GeomxTools</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: Biobase</span></span>
<span><span class="co">#&gt; Loading required package: BiocGenerics</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'BiocGenerics'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     IQR, mad, sd, var, xtabs</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     anyDuplicated, aperm, append, as.data.frame, basename, cbind,</span></span>
<span><span class="co">#&gt;     colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find,</span></span>
<span><span class="co">#&gt;     get, grep, grepl, intersect, is.unsorted, lapply, Map, mapply,</span></span>
<span><span class="co">#&gt;     match, mget, order, paste, pmax, pmax.int, pmin, pmin.int,</span></span>
<span><span class="co">#&gt;     Position, rank, rbind, Reduce, rownames, sapply, setdiff, sort,</span></span>
<span><span class="co">#&gt;     table, tapply, union, unique, unsplit, which.max, which.min</span></span>
<span><span class="co">#&gt; Welcome to Bioconductor</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Vignettes contain introductory material; view with</span></span>
<span><span class="co">#&gt;     'browseVignettes()'. To cite Bioconductor, see</span></span>
<span><span class="co">#&gt;     'citation("Biobase")', and for packages 'citation("pkgname")'.</span></span>
<span><span class="co">#&gt; Loading required package: NanoStringNCTools</span></span>
<span><span class="co">#&gt; Loading required package: S4Vectors</span></span>
<span><span class="co">#&gt; Loading required package: stats4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'S4Vectors'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:utils':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     findMatches</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     expand.grid, I, unname</span></span>
<span><span class="co">#&gt; Loading required package: ggplot2</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-ingestion">Data Ingestion<a class="anchor" aria-label="anchor" href="#data-ingestion"></a>
</h2>
<p>Files needed:</p>
<ol style="list-style-type: decimal">
<li>OME-TIFF from GeoMx instrument. (Other OME-TIFFs should work with
custom parsing functions.)</li>
<li>Lab Worksheet from instrument readout.</li>
<li>Annotation file(s):
<ul>
<li>Lab Worksheet</li>
<li>GeomxSet Object (see <a href="http://www.bioconductor.org/packages/release/bioc/html/GeomxTools.html" class="external-link">GeomxTools</a>
and <a href="https://www.bioconductor.org/packages/release/workflows/html/GeoMxWorkflows.html" class="external-link">GeoMxWorkflows</a>
for more info)</li>
<li>Annotations from DSPDA (DSP Data Analysis software)</li>
</ul>
</li>
</ol>
<p>In this example, we are downloading a TIFF image from AWS S3, but
this variable is simply the file path to an OME-TIFF.</p>
<p><strong><em>This function will be downloading a 13 GB file and will
keep a 4 GB file in BiocFileCache. This download should take ~15
minutes, but you will only have to download once. Note this will
download inside of the Docker image, but requires sufficient space on
your device hosting the image.</em></strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tifFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/downloadMouseBrainImage.html" class="external-link">downloadMouseBrainImage</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">tifFile</span></span>
<span><span class="co">#&gt; [1] "/github/home/.cache/R/SpatialOmicsOverlay/6c8284ef77e_mu_brain_004.ome.tiff"</span></span></code></pre></div>
<p><code><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/downloadMouseBrainImage.html" class="external-link">downloadMouseBrainImage()</a></code> will download files, in this
workshop, to the
<code>/home/rstudio/.cache/R/SpatialOmicsOverlay/</code> folder.</p>
<p>Reading in the SpatialOverlay object can be done with or without the
image. We will start without the image, as that can be added later.</p>
<p>If <code>outline = TRUE</code>, only ROI outline points are saved.
This decreases memory needed and figure rendering time downstream. If
ANY ROIs are segmented in the study, outline will be FALSE. In this
particular example, there are segmented ROIs, so we set
<code>outline = FALSE</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">muBrainLW</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"muBrain_LabWorksheet.txt"</span>,</span>
<span>                        package <span class="op">=</span> <span class="st">"SpatialOmicsOverlay"</span><span class="op">)</span></span>
<span><span class="va">muBrain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/readSpatialOverlay.html" class="external-link">readSpatialOverlay</a></span><span class="op">(</span>ometiff <span class="op">=</span> <span class="va">tifFile</span>, annots <span class="op">=</span> <span class="va">muBrainLW</span>,</span>
<span>                             slideName <span class="op">=</span> <span class="st">"4"</span>, image <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                             saveFile <span class="op">=</span> <span class="cn">FALSE</span>, outline <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting XML</span></span>
<span><span class="co">#&gt; Parsing XML - scan metadata</span></span>
<span><span class="co">#&gt; Parsing XML - overlay data</span></span>
<span><span class="co">#&gt; Warning in parseOverlayAttrs(omexml = xml, annots = annots, labworksheet = labWorksheet): Some AOIs do not match annotation file. </span></span>
<span><span class="co">#&gt; Not Matched: DSP-1012996073013-H-C01, DSP-1012996073013-H-C07, DSP-1012996073013-H-C08, DSP-1012996073013-H-C09, DSP-1012996073013-H-C12, DSP-1012996073013-H-G02</span></span>
<span><span class="co">#&gt; Generating Coordinates</span></span></code></pre></div>
<p>The <code>readSpatialOverlay</code> function is a wrapper to walk
through all of the necessary steps to store the OME-TIFF file
components. This function automates XML extraction &amp; parsing, image
extraction, and coordinate generation. These functions can also be run
separately if desired (<code>xmlExtraction</code>,
<code>parseScanMetadata</code>, <code>parseOverlayAttrs</code>,
<code>addImageOmeTiff</code>, <code>createCoordFile</code>).</p>
</div>
<div class="section level2">
<h2 id="spatialoverlay-accessors">SpatialOverlay Accessors<a class="anchor" aria-label="anchor" href="#spatialoverlay-accessors"></a>
</h2>
<p>SpatialOverlay objects hold data specific to the image and the ROIs.
Here are a couple of functions to access the most important parts.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#full object</span></span>
<span><span class="va">muBrain</span></span>
<span><span class="co">#&gt; SpatialOverlay </span></span>
<span><span class="co">#&gt; Slide Name: 4 </span></span>
<span><span class="co">#&gt; Overlay Data: 87 samples </span></span>
<span><span class="co">#&gt;    Overlay Names: DSP-1012996073013-H-A02 ... DSP-1012996073013-H-H09 ( 87 total ) </span></span>
<span><span class="co">#&gt; Scan Metadata </span></span>
<span><span class="co">#&gt;    Panels: TAP Mouse Whole Transcriptome Atlas </span></span>
<span><span class="co">#&gt;    Segmentation: Segmented </span></span>
<span><span class="co">#&gt; Outline: FALSE</span></span>
<span><span class="co">#sample names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/SpatialOverlay-class.html" class="external-link">sampNames</a></span><span class="op">(</span><span class="va">muBrain</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "DSP-1012996073013-H-A02" "DSP-1012996073013-H-A03"</span></span>
<span><span class="co">#&gt; [3] "DSP-1012996073013-H-A04" "DSP-1012996073013-H-A05"</span></span>
<span><span class="co">#&gt; [5] "DSP-1012996073013-H-A06" "DSP-1012996073013-H-A07"</span></span>
<span><span class="co">#slide name</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/SpatialOverlay-class.html" class="external-link">slideName</a></span><span class="op">(</span><span class="va">muBrain</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "4"</span></span>
<span><span class="co">#metadata of ROI overlays</span></span>
<span><span class="co">#Height, Width, X, Y values are in pixels</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/SpatialPosition-class.html" class="external-link">meta</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/SpatialOverlay-class.html" class="external-link">overlay</a></span><span class="op">(</span><span class="va">muBrain</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   ROILabel               Sample_ID Height Width     X     Y Segmentation</span></span>
<span><span class="co">#&gt; 1        1 DSP-1012996073013-H-A02    751   751 10363 15008    Geometric</span></span>
<span><span class="co">#&gt; 2        2 DSP-1012996073013-H-A03   1239   782 14346 16630    Geometric</span></span>
<span><span class="co">#&gt; 3        3 DSP-1012996073013-H-A04   1272   902 15664 16603    Geometric</span></span>
<span><span class="co">#&gt; 4        4 DSP-1012996073013-H-A05   1119  1276 13707 16135    Geometric</span></span>
<span><span class="co">#&gt; 5        5 DSP-1012996073013-H-A06   1054  1124 15932 16228    Geometric</span></span>
<span><span class="co">#&gt; 6        6 DSP-1012996073013-H-A07    751   751 10756 14259    Geometric</span></span>
<span><span class="co">#coordinates of each ROI</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/SpatialOverlay-class.html" class="external-link">coords</a></span><span class="op">(</span><span class="va">muBrain</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  sampleID ycoor xcoor</span></span>
<span><span class="co">#&gt; 1 DSP-1012996073013-H-A02 15383 10363</span></span>
<span><span class="co">#&gt; 2 DSP-1012996073013-H-A02 15356 10364</span></span>
<span><span class="co">#&gt; 3 DSP-1012996073013-H-A02 15357 10364</span></span>
<span><span class="co">#&gt; 4 DSP-1012996073013-H-A02 15358 10364</span></span>
<span><span class="co">#&gt; 5 DSP-1012996073013-H-A02 15359 10364</span></span>
<span><span class="co">#&gt; 6 DSP-1012996073013-H-A02 15360 10364</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plotting-without-image">Plotting Without Image<a class="anchor" aria-label="anchor" href="#plotting-without-image"></a>
</h2>
<p>After parsing, ROIs can be plotted without the image in the object.
These plots are the highest resolution versions since there is no
scaling down to the image size. They might take a little time to render.
If the image is attached to the object, coordinates are automatically
scaled down to the image size and plotted as if they are on top of the
image.</p>
<p>While manipulating the figure, there is a low-resolution option for
faster rendering times.</p>
<p>A scale bar is automatically calculated when plotting. This
functionality can be turned off using <code>scaleBar = FALSE</code>.
Scale bars can be fully customized using <code>corner</code>,
<code>textDistance</code>, and variables that start with scaleBar:
<code>scaleBarWidth</code>, <code>scaleBarColor</code>, etc.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/plotSpatialOverlay.html" class="external-link">plotSpatialOverlay</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">muBrain</span>, hiRes <span class="op">=</span> <span class="cn">FALSE</span>, legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><code>colorBy</code>, by default, is Sample_ID but almost any
annotation or data can be added instead, including gene expression,
tissue morphology annotations, pathway score, etc. These annotations can
come from a data.frame, matrix, GeomxSet object, or vector. Below we
attach the gene expression for CALM1 from a GeomxSet object and color
the segments by that value.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">muBrainAnnots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/readLabWorksheet.html" class="external-link">readLabWorksheet</a></span><span class="op">(</span>lw <span class="op">=</span> <span class="va">muBrainLW</span>, slideName <span class="op">=</span> <span class="st">"4"</span><span class="op">)</span></span>
<span><span class="va">muBrainGeomxSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"muBrain_GxT.zip"</span>,</span>
<span>                                 package <span class="op">=</span> <span class="st">"SpatialOmicsOverlay"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">muBrain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/addPlottingFactor.html" class="external-link">addPlottingFactor</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">muBrain</span>, annots <span class="op">=</span> <span class="va">muBrainAnnots</span>,</span>
<span>                            plottingFactor <span class="op">=</span> <span class="st">"segment"</span><span class="op">)</span></span>
<span><span class="va">muBrain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/addPlottingFactor.html" class="external-link">addPlottingFactor</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">muBrain</span>, annots <span class="op">=</span> <span class="va">muBrainGeomxSet</span>,</span>
<span>                             plottingFactor <span class="op">=</span> <span class="st">"Calm1"</span><span class="op">)</span></span>
<span><span class="va">muBrain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/addPlottingFactor.html" class="external-link">addPlottingFactor</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">muBrain</span>, annots <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/SpatialOverlay-class.html" class="external-link">sampNames</a></span><span class="op">(</span><span class="va">muBrain</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                             plottingFactor <span class="op">=</span> <span class="st">"ROILabel"</span><span class="op">)</span></span>
<span><span class="va">muBrain</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/SpatialOverlay-class.html" class="external-link">plotFactors</a></span><span class="op">(</span><span class="va">muBrain</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="customizing-the-graph">Customizing the graph<a class="anchor" aria-label="anchor" href="#customizing-the-graph"></a>
</h2>
<p>All generated figures are ggplot based so they can be easily
customized using functions from that or similar grammar of graphs
packages. For example, we can change the color scale to the
<code>viridis</code> color palette.</p>
<p><strong>Note: <code>hiRes</code> and <code>outline</code> figures use
fill. <code>lowRes</code> uses color.</strong></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/plotSpatialOverlay.html" class="external-link">plotSpatialOverlay</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">muBrain</span>, hiRes <span class="op">=</span> <span class="cn">TRUE</span>, colorBy <span class="op">=</span> <span class="st">"Calm1"</span>,</span>
<span>                   scaleBarWidth <span class="op">=</span> <span class="fl">0.3</span>, scaleBarColor <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_color_viridis</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Calm1 Expression in Mouse Brain"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adding-the-image">Adding the Image<a class="anchor" aria-label="anchor" href="#adding-the-image"></a>
</h2>
<p>Images can be added automatically using
<code>readSpatialOverlay(image = TRUE)</code> or added after reading in
the object.</p>
<p>An OME-TIFF file is a pyramidal file, meaning that many resolutions
(sizes) of an image are saved. The largest slice has the highest
resolution. Size decreases as the image gets smaller. Images are 1/2 the
length and width as the previous resolution. Stacked upon each other,
one can conceptualize a “pyramidal” shape.</p>
<div class="figure">
<img src="pyramidalTIFF.png" alt="Pyramidal TIFF" width="50%"><p class="caption">
Pyramidal TIFF
</p>
</div>
<p>The <code>res</code> variable says which resolution of the image to
extract. 1 = largest image, or the bottom of the OME-TIFF “pyramid”.
Higher <code>res</code> values indicate the smaller, lower resolution
versions of the image. Each OME-TIFF has a different number of layers,
with most GeoMx experiment files having around 8. It is suggested to use
the smallest <code>res</code> value (highest resolution) your
environment can handle. This is a trial and error process.</p>
<p>Using too big of an image will cause a java memory error. If this
error occurs, increase your <code>res</code> value. Below is an example
of the error you will receive if the resolution is too high for your own
system.</p>
<pre><code>Error in .jcall("RBioFormats", "Ljava/lang/Object;", "readPixels", i,  : 
  java.lang.NegativeArraySizeException: -2147483648</code></pre>
<p>The resolution size will affect speed and image resolution through
the rest of the analysis. To check the smallest resolution size
available, for the fastest speeds, use <code><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/checkValidRes.html" class="external-link">checkValidRes()</a></code>. For
the rest of this tutorial we will be using <code>res = 4</code> for
vignette size restrictions; <code>res</code> 4-6 is generally
recommended.</p>
<p>Note: If <code>res =4</code> is giving you an error, try restarting R
and/or increasing the <code>res</code> value (remember higher
<code>res</code> parameter = higher slice on OME-TIFF pyramid = smaller
and lower resolution image).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#lowest resolution = fastest speeds</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/checkValidRes.html" class="external-link">checkValidRes</a></span><span class="op">(</span>ometiff <span class="op">=</span> <span class="va">tifFile</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">muBrain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/addImageOmeTiff.html" class="external-link">addImageOmeTiff</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">muBrain</span>, ometiff <span class="op">=</span> <span class="va">tifFile</span>, res <span class="op">=</span> <span class="va">res</span><span class="op">)</span></span>
<span><span class="va">muBrain</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/SpatialOverlay-class.html" class="external-link">showImage</a></span><span class="op">(</span><span class="va">muBrain</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/plotSpatialOverlay.html" class="external-link">plotSpatialOverlay</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">muBrain</span>, colorBy <span class="op">=</span> <span class="st">"segment"</span>, corner <span class="op">=</span> <span class="st">"topcenter"</span>,</span>
<span>                   scaleBarWidth <span class="op">=</span> <span class="fl">0.5</span>, textDistance <span class="op">=</span> <span class="fl">130</span>, scaleBarColor <span class="op">=</span> <span class="st">"cyan"</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="visualization-marker-legends">Visualization Marker Legends<a class="anchor" aria-label="anchor" href="#visualization-marker-legends"></a>
</h4>
<p>There are two ways to add a legend to the graph showing the
immunofluorescence visualization markers used.</p>
<p>The first is an easy way for data exploration: adding a legend to the
ggplot object directly by setting <code>flourLegend = TRUE</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/plotSpatialOverlay.html" class="external-link">plotSpatialOverlay</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">muBrain</span>, colorBy <span class="op">=</span> <span class="st">"segment"</span>, corner <span class="op">=</span> <span class="st">"topcenter"</span>,</span>
<span>                   scaleBarWidth <span class="op">=</span> <span class="fl">0.5</span>, textDistance <span class="op">=</span> <span class="fl">130</span>, scaleBarColor <span class="op">=</span> <span class="st">"cyan"</span>,</span>
<span>                   fluorLegend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The second requires more user manipulation, but creates a more
publication-ready figure. The <code>flourLegend</code> function creates
a separate plot that can be added to the graph. The legend shape can be
changed with <code>nrow</code> and the background can be changed using
<code>boxColor</code> and <code>alpha</code>.</p>
<p>See <code><a href="https://wilkelab.org/cowplot/reference/draw_plot.html" class="external-link">?draw_plot</a></code> for more instructions on how to
manipulate the legend position and scale.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span><span class="va">gp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/plotSpatialOverlay.html" class="external-link">plotSpatialOverlay</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">muBrain</span>, colorBy <span class="op">=</span> <span class="st">"segment"</span>,</span>
<span>                         corner <span class="op">=</span> <span class="st">"bottomright"</span><span class="op">)</span></span>
<span><span class="va">legend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/fluorLegend.html" class="external-link">fluorLegend</a></span><span class="op">(</span><span class="va">muBrain</span>, nrow <span class="op">=</span> <span class="fl">2</span>, textSize <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                      boxColor <span class="op">=</span> <span class="st">"grey85"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html" class="external-link">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html" class="external-link">draw_plot</a></span><span class="op">(</span><span class="va">gp</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html" class="external-link">draw_plot</a></span><span class="op">(</span><span class="va">legend</span>, scale <span class="op">=</span> <span class="fl">0.105</span>, x <span class="op">=</span> <span class="fl">0.1</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">0.25</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="image-manipulation">Image Manipulation<a class="anchor" aria-label="anchor" href="#image-manipulation"></a>
</h2>
<div class="section level4">
<h4 id="flipping-axes">Flipping Axes<a class="anchor" aria-label="anchor" href="#flipping-axes"></a>
</h4>
<p>Images and overlays can be flipped across either axis to reorient the
image. To flip both axes, use <code>flipY(flipX(overlay))</code>. These
functions update the coordinates and image rather than just affecting
the figure. You cannot run these commands until the image is associated
with the spatial overlay object. If you want to reverse axes on a plot
that features only ROIs, and not the underlying image, you can run
<code><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/plotSpatialOverlay.html" class="external-link">plotSpatialOverlay()</a></code> with the <code>overlay</code> object
flipped at will and the parameter <code>image=FALSE</code>.</p>
<p>In this example, the original image is reversed from the traditional
view of the mouse brain, so we shall flip the y-axis.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">muBrain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/flipY.html" class="external-link">flipY</a></span><span class="op">(</span><span class="va">muBrain</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/plotSpatialOverlay.html" class="external-link">plotSpatialOverlay</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">muBrain</span>, colorBy <span class="op">=</span> <span class="st">"segment"</span>, scaleBar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/plotSpatialOverlay.html" class="external-link">plotSpatialOverlay</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/flipX.html" class="external-link">flipX</a></span><span class="op">(</span><span class="va">muBrain</span><span class="op">)</span>, colorBy <span class="op">=</span> <span class="st">"segment"</span>, scaleBar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="cropping">Cropping<a class="anchor" aria-label="anchor" href="#cropping"></a>
</h4>
<p>Images can be cropped in two ways. The amount of area added to the
cropped area in both methods can be defined by <code>buffer</code>. This
adds a percentage of the final image size to each edge.</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/cropTissue.html" class="external-link">cropTissue()</a></code> automatically detects where the tissue is
and removes the surrounding blank area.</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">muBrain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/cropTissue.html" class="external-link">cropTissue</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">muBrain</span>, buffer <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/plotSpatialOverlay.html" class="external-link">plotSpatialOverlay</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">muBrain</span>, colorBy <span class="op">=</span> <span class="st">"ROILabel"</span>, legend <span class="op">=</span> <span class="cn">FALSE</span>, scaleBar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"C"</span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>
<code><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/cropSamples.html" class="external-link">cropSamples()</a></code> automatically crops the image around the
ROIs given. Other ROIs in the cropped image can be kept in or ignored.
Below we will crop to only ROIs that are unsegmented, hiding ROIs
profiles that are segmented. Setting <code>sampsOnly = TRUE</code> hides
the segmented ROIs within the plotted region.</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samps</span> <span class="op">&lt;-</span> <span class="va">muBrainAnnots</span><span class="op">$</span><span class="va">Sample_ID</span><span class="op">[</span><span class="va">muBrainAnnots</span><span class="op">$</span><span class="va">segment</span> <span class="op">==</span> <span class="st">"Full ROI"</span> <span class="op">&amp;</span></span>
<span>                                     <span class="va">muBrainAnnots</span><span class="op">$</span><span class="va">slide.name</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/SpatialOverlay-class.html" class="external-link">slideName</a></span><span class="op">(</span><span class="va">muBrain</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">muBrainCrop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/cropSamples.html" class="external-link">cropSamples</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">muBrain</span>, sampleIDs <span class="op">=</span> <span class="va">samps</span>, sampsOnly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/plotSpatialOverlay.html" class="external-link">plotSpatialOverlay</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">muBrainCrop</span>, colorBy <span class="op">=</span> <span class="st">"Calm1"</span>, scaleBar <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   corner <span class="op">=</span> <span class="st">"bottomleft"</span>, textDistance <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"grey"</span>, high <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>                                  mid <span class="op">=</span> <span class="st">"yellow"</span>, midpoint <span class="op">=</span> <span class="fl">2500</span><span class="op">)</span></span>
<span></span>
<span><span class="va">muBrainCrop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/cropSamples.html" class="external-link">cropSamples</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">muBrain</span>, sampleIDs <span class="op">=</span> <span class="va">samps</span>, sampsOnly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/plotSpatialOverlay.html" class="external-link">plotSpatialOverlay</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">muBrainCrop</span>, colorBy <span class="op">=</span> <span class="st">"segment"</span>, scaleBar <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   corner <span class="op">=</span> <span class="st">"bottomleft"</span>, textDistance <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="image-coloring">Image Coloring<a class="anchor" aria-label="anchor" href="#image-coloring"></a>
</h4>
<p>Image colors and contrast settings are typically determined by user
on the GeoMx DSP instrument before exporting the OME-TIFF. However, the
<code>SpatialOmicsOverlay</code> package allows users to affect the
coloring during analysis.</p>
<p>This recoloring must be done on the 4-channel image before converting
to RGB. The color code and min/max intensities determine the coloring of
the RGB image. To view the current color definition use the
<code>fluor</code> function.</p>
<p>The color can be a hex color or a valid R color name. The dye can
either come from the <code>Dye</code> or <code>DisplayName</code>
columns from <code>fluor(overlay)</code>. To change a color, use the
<code>changeImageColoring</code> function.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chan4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/add4ChannelImage.html" class="external-link">add4ChannelImage</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">muBrain</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/SpatialOverlay-class.html" class="external-link">fluor</a></span><span class="op">(</span><span class="va">chan4</span><span class="op">)</span></span>
<span><span class="va">chan4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/changeImageColoring.html" class="external-link">changeImageColoring</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">chan4</span>, color <span class="op">=</span> <span class="st">"#32a8a4"</span>, dye <span class="op">=</span> <span class="st">"FITC"</span><span class="op">)</span></span>
<span><span class="va">chan4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/changeImageColoring.html" class="external-link">changeImageColoring</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">chan4</span>, color <span class="op">=</span> <span class="st">"magenta"</span>, dye <span class="op">=</span> <span class="st">"Alexa 647"</span><span class="op">)</span></span>
<span><span class="va">chan4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/changeColoringIntensity.html" class="external-link">changeColoringIntensity</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">chan4</span>, minInten <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                                 maxInten <span class="op">=</span> <span class="fl">10000</span>, dye <span class="op">=</span> <span class="st">"Cy5"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/SpatialOverlay-class.html" class="external-link">fluor</a></span><span class="op">(</span><span class="va">chan4</span><span class="op">)</span></span>
<span><span class="co"># change 4 channel TIFF to RGB</span></span>
<span><span class="va">chan4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/recolor.html" class="external-link">recolor</a></span><span class="op">(</span><span class="va">chan4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SpatialOmicsOverlay/man/SpatialOverlay-class.html" class="external-link">showImage</a></span><span class="op">(</span><span class="va">chan4</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="future-directions">Future Directions<a class="anchor" aria-label="anchor" href="#future-directions"></a>
</h2>
<p>In future releases of <code>SpatialOmicsOverlay</code>, we will
be:</p>
<ol style="list-style-type: decimal">
<li>Ensuring capability with NanoString’s <a href="https://nanostring.com/products/cosmx-spatial-molecular-imager/" class="external-link">CosMx
Spatial Molecular Imager</a> outputs.</li>
<li>Adding ability to add graphing features on top of the image.</li>
<li>Adding image analysis capabilities.</li>
<li>Adding extraction of image data to use in ML/AI applications.</li>
</ol>
<p>For your reference:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>NanoString Technologies, Inc.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Maddy Griswold.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
