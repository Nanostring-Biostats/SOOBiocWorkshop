<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to SpatialOmicsOverlay • SpatialOmicsOverlayWorkshop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to SpatialOmicsOverlay">
<meta property="og:description" content="SpatialOmicsOverlayWorkshop">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SpatialOmicsOverlayWorkshop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/HOWTO_BUILD_WORKSHOP.html">How To Build A Workshop Package</a>
    </li>
    <li>
      <a href="../articles/Introduction-to-SOO.html">Introduction to SpatialOmicsOverlay</a>
    </li>
    <li>
      <a href="../articles/workshop_example.html">An Example Workshop</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nanostring-biostats/SOOBiocWorkshop" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to SpatialOmicsOverlay</h1>
                        <h4 data-toc-skip class="author">Maddy Griswold
and Megan Vandenberg<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nanostring-biostats/SOOBiocWorkshop/blob/HEAD/vignettes/Introduction-to-SOO.Rmd" class="external-link"><code>vignettes/Introduction-to-SOO.Rmd</code></a></small>
      <div class="hidden name"><code>Introduction-to-SOO.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="adjust-path">Adjust PATH<a class="anchor" aria-label="anchor" href="#adjust-path"></a>
</h2>
<p>Required to properly load the SpatialOmicsOverlay dependency
RBioFormats.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">old_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"echo $PATH"</span>, intern<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">old_path</span>, <span class="st">"RBioFormats"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">new_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">old_path</span>, <span class="st">"/usr/local/lib/R/site-library/RBioFormats/"</span>, sep <span class="op">=</span> <span class="st">":"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>PATH <span class="op">=</span> <span class="va">new_path</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"echo $PATH"</span><span class="op">)</span></span></code></pre></div>
<p><strong><em>Restart R after running the above
chunk.</em></strong></p>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette demonstrates how to use OME-TIFF files generated by the
NanoString GeoMx <sup>®</sup> Digital Spatial Profiler (DSP) instrument
to enhance the data visualization. SpatialOmicsOverlay was specifically
made to visualize and analyze the free-handed nature of Region of
Interest (ROI) selection in a GeoMx experiment, and the
immunofluorescence-guided segmentation process. The overlay from the
instrument is recreated in the R environment allowing for plotting
overlays with data like ROI type or gene expression.</p>
<p>In this vignette, we will be walking through a mouse brain dataset
from the <a href="https://nanostring.com/products/geomx-digital-spatial-profiler/spatial-organ-atlas/mouse-brain/" class="external-link">Spatial
Organ Atlas</a>. While we will be looking at only one sample, any of the
data from our freely-downloadable Spatial Organ Atlas samples would also
suffice.</p>
<p>The SpatialOmicsOverlay package is <a href="https://bioconductor.org/packages/release/bioc/html/SpatialOmicsOverlay.html" class="external-link">now
available</a> through Bioconductor.</p>
</div>
<div class="section level2">
<h2 id="load-libraries">Load Libraries<a class="anchor" aria-label="anchor" href="#load-libraries"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># library(SpatialOmicsOverlay)</span></span>
<span><span class="co"># library(GeomxTools)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SOO_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="data-ingestion">Data Ingestion<a class="anchor" aria-label="anchor" href="#data-ingestion"></a>
</h2>
<p>Files needed:</p>
<ol style="list-style-type: decimal">
<li>OME-TIFF from GeoMx instrument. (Other OME-TIFFs should work with
custom parsing functions.)</li>
<li>Lab Worksheet from instrument readout.</li>
<li>Annotation file(s):
<ul>
<li>Lab Worksheet</li>
<li>GeomxSet Object (see <a href="http://www.bioconductor.org/packages/release/bioc/html/GeomxTools.html" class="external-link">GeomxTools</a>
and <a href="https://www.bioconductor.org/packages/release/workflows/html/GeoMxWorkflows.html" class="external-link">GeoMxWorkflows</a>
for more info)</li>
<li>Annotations from DSPDA (DSP Data Analysis software)</li>
</ul>
</li>
</ol>
<p>In this example, we are downloading a TIFF image from AWS S3, but
this variable is simply the file path to an OME-TIFF.</p>
<p><strong><em>This function will be downloading a 13 GB file and will
keep a 4 GB file in BiocFileCache. This download should take ~15
minutes, but you will only have to download once. Note this will
download inside of the Docker image, but requires sufficient space on
your device hosting the image.</em></strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tifFile &lt;- downloadMouseBrainImage()</span></span>
<span><span class="co"># tifFile</span></span></code></pre></div>
<p>Reading in the SpatialOverlay object can be done with or without the
image. We will start without the image, as that can be added later.</p>
<p>If <code>outline = TRUE</code>, only ROI outline points are saved.
This decreases memory needed and figure rendering time downstream. If
ANY ROIs are segmented in the study, outline will be FALSE. In this
particular example, there are segmented ROIs, so we set
<code>outline = FALSE</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># muBrainLW &lt;- system.file("extdata", "muBrain_LabWorksheet.txt",</span></span>
<span><span class="co">#                         package = "SpatialOmicsOverlay")</span></span>
<span><span class="co"># muBrain &lt;- readSpatialOverlay(ometiff = tifFile, annots = muBrainLW,</span></span>
<span><span class="co">#                              slideName = "4", image = FALSE,</span></span>
<span><span class="co">#                              saveFile = FALSE, outline = FALSE)</span></span></code></pre></div>
<p>The <code>readSpatialOverlay</code> function is a wrapper to walk
through all of the necessary steps to store the OME-TIFF file
components. This function automates XML extraction &amp; parsing, image
extraction, and coordinate generation. These functions can also be run
separately if desired (<code>xmlExtraction</code>,
<code>parseScanMetadata</code>, <code>parseOverlayAttrs</code>,
<code>addImageOmeTiff</code>, <code>createCoordFile</code>).</p>
</div>
<div class="section level2">
<h2 id="spatialoverlay-accessors">SpatialOverlay Accessors<a class="anchor" aria-label="anchor" href="#spatialoverlay-accessors"></a>
</h2>
<p>SpatialOverlay objects hold data specific to the image and the ROIs.
Here are a couple of functions to access the most important parts.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># #full object</span></span>
<span><span class="co"># muBrain</span></span>
<span><span class="co"># #sample names</span></span>
<span><span class="co"># head(sampNames(muBrain))</span></span>
<span><span class="co"># #slide name</span></span>
<span><span class="co"># slideName(muBrain)</span></span>
<span><span class="co"># #metadata of ROI overlays</span></span>
<span><span class="co"># #Height, Width, X, Y values are in pixels</span></span>
<span><span class="co"># head(meta(overlay(muBrain)))</span></span>
<span><span class="co"># #coordinates of each ROI</span></span>
<span><span class="co"># head(coords(muBrain))</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plotting-without-image">Plotting Without Image<a class="anchor" aria-label="anchor" href="#plotting-without-image"></a>
</h2>
<p>After parsing, ROIs can be plotted without the image in the object.
These plots are the highest resolution versions since there is no
scaling down to the image size. They might take a little time to render.
If the image is attached to the object, coordinates are automatically
scaled down to the image size and plotted as if they are on top of the
image.</p>
<p>While manipulating the figure, there is a low-resolution option for
faster rendering times.</p>
<p>A scale bar is automatically calculated when plotting. This
functionality can be turned off using <code>scaleBar = FALSE</code>.
Scale bars can be fully customized using <code>corner</code>,
<code>textDistance</code>, and variables that start with scaleBar:
<code>scaleBarWidth</code>, <code>scaleBarColor</code>, etc.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plotSpatialOverlay(overlay = muBrain, hiRes = FALSE, legend = FALSE)</span></span></code></pre></div>
<p><code>colorBy</code>, by default, is Sample_ID but almost any
annotation or data can be added instead, including gene expression,
tissue morphology annotations, pathway score, etc. These annotations can
come from a data.frame, matrix, GeomxSet object, or vector. Below we
attach the gene expression for CALM1 from a GeomxSet object and color
the segments by that value.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># muBrainAnnots &lt;- readLabWorksheet(lw = muBrainLW, slideName = "4")</span></span>
<span><span class="co"># muBrainGeomxSet &lt;- readRDS(unzip(system.file("extdata", "muBrain_GxT.zip",</span></span>
<span><span class="co">#                                  package = "SpatialOmicsOverlay")))</span></span>
<span><span class="co"># muBrain &lt;- addPlottingFactor(overlay = muBrain, annots = muBrainAnnots,</span></span>
<span><span class="co">#                             plottingFactor = "segment")</span></span>
<span><span class="co"># muBrain &lt;- addPlottingFactor(overlay = muBrain, annots = muBrainGeomxSet,</span></span>
<span><span class="co">#                              plottingFactor = "Calm1")</span></span>
<span><span class="co"># muBrain &lt;- addPlottingFactor(overlay = muBrain, annots = 1:length(sampNames(muBrain)),</span></span>
<span><span class="co">#                              plottingFactor = "ROILabel")</span></span>
<span><span class="co"># muBrain</span></span>
<span><span class="co"># head(plotFactors(muBrain))</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="customizing-the-graph">Customizing the graph<a class="anchor" aria-label="anchor" href="#customizing-the-graph"></a>
</h2>
<p>All generated figures are ggplot based so they can be easily
customized using functions from that or similar grammar of graphs
packages. For example, we can change the color scale to the
<code>viridis</code> color palette.</p>
<p><strong>Note: <code>hiRes</code> and <code>outline</code> figures use
fill. <code>lowRes</code> uses color.</strong></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plotSpatialOverlay(overlay = muBrain, hiRes = TRUE, colorBy = "Calm1",</span></span>
<span><span class="co">#                    scaleBarWidth = 0.3, scaleBarColor = "green") +</span></span>
<span><span class="co">#     viridis::scale_color_viridis()+</span></span>
<span><span class="co">#     ggplot2::labs(title = "Calm1 Expression in Mouse Brain")</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adding-the-image">Adding the Image<a class="anchor" aria-label="anchor" href="#adding-the-image"></a>
</h2>
<p>Images can be added automatically using
<code>readSpatialOverlay(image = TRUE)</code> or added after reading in
the object.</p>
<p>An OME-TIFF file is a pyramidal file, meaning that many resolutions
(sizes) of an image are saved. The largest slice has the highest
resolution. Size decreases as the image gets smaller. Images are 1/2 the
length and width as the previous resolution. Stacked upon each other,
one can conceptualize a “pyramidal” shape.</p>
<p>The <code>res</code> variable says which resolution of the image to
extract. 1 = largest image, or the bottom of the OME-TIFF “pyramid”.
Higher <code>res</code> values indicate the smaller, lower resolution
versions of the image. Each OME-TIFF has a different number of layers,
with most GeoMx experiment files having around 8. It is suggested to use
the smallest <code>res</code> value (highest resolution) your
environment can handle. This is a trial and error process.</p>
<p>Using too big of an image will cause a java memory error. If this
error occurs, increase your <code>res</code> value. Below is an example
of the error you will receive if the resolution is too high for your own
system.</p>
<pre><code>Error in .jcall("RBioFormats", "Ljava/lang/Object;", "readPixels", i,  : 
  java.lang.NegativeArraySizeException: -2147483648</code></pre>
<p>The resolution size will affect speed and image resolution through
the rest of the analysis. To check the smallest resolution size
available, for the fastest speeds, use <code>checkValidRes()</code>. For
the rest of this tutorial we will be using <code>res = 4</code> for
vignette size restrictions; <code>res</code> 4-6 is generally
recommended.</p>
<p>Note: If <code>res =4</code> is giving you an error, try restarting R
and/or increasing the <code>res</code> value (remember higher
<code>res</code> parameter = higher slice on OME-TIFF pyramid = smaller
and lower resolution image).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># #lowest resolution = fastest speeds</span></span>
<span><span class="co"># checkValidRes(ometiff = tifFile)</span></span>
<span><span class="co"># res &lt;- 4</span></span>
<span><span class="co"># muBrain &lt;- addImageOmeTiff(overlay = muBrain, ometiff = tifFile, res = res)</span></span>
<span><span class="co"># muBrain</span></span>
<span><span class="co"># showImage(muBrain)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plotSpatialOverlay(overlay = muBrain, colorBy = "segment", corner = "topcenter",</span></span>
<span><span class="co">#                    scaleBarWidth = 0.5, textDistance = 130, scaleBarColor = "cyan")</span></span></code></pre></div>
<div class="section level4">
<h4 id="visualization-marker-legends">Visualization Marker Legends<a class="anchor" aria-label="anchor" href="#visualization-marker-legends"></a>
</h4>
<p>There are two ways to add a legend to the graph showing the
immunofluorescence visualization markers used.</p>
<p>The first is an easy way for data exploration: adding a legend to the
ggplot object directly by setting <code>flourLegend = TRUE</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plotSpatialOverlay(overlay = muBrain, colorBy = "segment", corner = "topcenter",</span></span>
<span><span class="co">#                    scaleBarWidth = 0.5, textDistance = 130, scaleBarColor = "cyan",</span></span>
<span><span class="co">#                    fluorLegend = TRUE)</span></span></code></pre></div>
<p>The second requires more user manipulation, but creates a more
publication-ready figure. The <code>flourLegend</code> function creates
a separate plot that can be added to the graph. The legend shape can be
changed with <code>nrow</code> and the background can be changed using
<code>boxColor</code> and <code>alpha</code>.</p>
<p>See <code>?draw_plot</code> for more instructions on how to
manipulate the legend position and scale.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># library(cowplot)</span></span>
<span><span class="co"># gp &lt;- plotSpatialOverlay(overlay = muBrain, colorBy = "segment",</span></span>
<span><span class="co">#                          corner = "bottomright")</span></span>
<span><span class="co"># legend &lt;- fluorLegend(muBrain, nrow = 2, textSize = 4,</span></span>
<span><span class="co">#                       boxColor = "grey85", alpha = 0.3)</span></span>
<span><span class="co"># cowplot::ggdraw() +</span></span>
<span><span class="co">#     cowplot::draw_plot(gp) +</span></span>
<span><span class="co">#     cowplot::draw_plot(legend, scale = 0.105, x = 0.1, y = -0.25)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="image-manipulation">Image Manipulation<a class="anchor" aria-label="anchor" href="#image-manipulation"></a>
</h2>
<div class="section level4">
<h4 id="flipping-axes">Flipping Axes<a class="anchor" aria-label="anchor" href="#flipping-axes"></a>
</h4>
<p>Images and overlays can be flipped across either axis to reorient the
image. To flip both axes, use <code>flipY(flipX(overlay))</code>. These
functions update the coordinates and image rather than just affecting
the figure. You cannot run these commands until the image is associated
with the spatial overlay object. If you want to plot ROIs with the axes
flipped, after adding in the image, you can run
<code>plotSpatialOverlay(image=FALSE)</code>.</p>
<p>In this example, the original image is reversed from the traditional
view of the mouse brain, so we shall flip the y-axis.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># muBrain &lt;- flipY(muBrain)</span></span>
<span><span class="co"># plotSpatialOverlay(overlay = muBrain, colorBy = "segment", scaleBar = FALSE)</span></span>
<span><span class="co"># plotSpatialOverlay(overlay = flipX(muBrain), colorBy = "segment", scaleBar = FALSE)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="cropping">Cropping<a class="anchor" aria-label="anchor" href="#cropping"></a>
</h4>
<p>Images can be cropped in two ways. The amount of area added to the
cropped area in both methods can be defined by <code>buffer</code>. This
adds a percentage of the final image size to each edge.</p>
<ol style="list-style-type: decimal">
<li>
<code>cropTissue</code> automatically detects where the tissue is
and removes non-tissue area from around the tissue.</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># muBrain &lt;- cropTissue(overlay = muBrain, buffer = 0.05)</span></span>
<span><span class="co"># plotSpatialOverlay(overlay = muBrain, colorBy = "ROILabel", legend = FALSE, scaleBar = FALSE)+</span></span>
<span><span class="co">#     viridis::scale_fill_viridis(option = "C")</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>
<code>cropSamples</code> automatically crops the image around the
ROIs given. Other ROIs in the cropped image can be kept in or ignored.
Below we will crop to only ROIs that are unsegmented, hiding ROIs
profiles that are segmented. Setting <code>sampsOnly = TRUE</code> hides
the segmented ROIs within the plotted region.</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># samps &lt;- muBrainAnnots$Sample_ID[muBrainAnnots$segment == "Full ROI" &amp;</span></span>
<span><span class="co">#                                      muBrainAnnots$slide.name == slideName(muBrain)]</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># muBrainCrop &lt;- cropSamples(overlay = muBrain, sampleIDs = samps, sampsOnly = TRUE)</span></span>
<span><span class="co"># plotSpatialOverlay(overlay = muBrainCrop, colorBy = "Calm1", scaleBar = TRUE,</span></span>
<span><span class="co">#                    corner = "bottomleft", textDistance = 5)+</span></span>
<span><span class="co">#     ggplot2::scale_fill_gradient2(low = "grey", high = "red",</span></span>
<span><span class="co">#                                   mid = "yellow", midpoint = 2500)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># muBrainCrop &lt;- cropSamples(overlay = muBrain, sampleIDs = samps, sampsOnly = FALSE)</span></span>
<span><span class="co"># plotSpatialOverlay(overlay = muBrainCrop, colorBy = "segment", scaleBar = TRUE,</span></span>
<span><span class="co">#                    corner = "bottomleft", textDistance = 5)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="image-coloring">Image Coloring<a class="anchor" aria-label="anchor" href="#image-coloring"></a>
</h4>
<p>Image colors and contrast settings are typically determined by user
on the GeoMx DSP instrument before exporting the OME-TIFF. However, the
<code>SpatialOmicsOverlay</code> package allows users to affect the
coloring during analysis.</p>
<p>This recoloring must be done on the 4-channel image before converting
to RGB. The color code and min/max intensities determine the coloring of
the RGB image. To view the current color definition use the
<code>fluor</code> function.</p>
<p>The color can be a hex color or a valid R color name. The dye can
either come from the <code>Dye</code> or <code>DisplayName</code>
columns from <code>fluor(overlay)</code>. To change a color, use the
<code>changeImageColoring</code> function.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># chan4 &lt;- add4ChannelImage(overlay = muBrain)</span></span>
<span><span class="co"># fluor(chan4)</span></span>
<span><span class="co"># chan4 &lt;- changeImageColoring(overlay = chan4, color = "#32a8a4", dye = "FITC")</span></span>
<span><span class="co"># chan4 &lt;- changeImageColoring(overlay = chan4, color = "magenta", dye = "Alexa 647")</span></span>
<span><span class="co"># chan4 &lt;- changeColoringIntensity(overlay = chan4, minInten = 500,</span></span>
<span><span class="co">#                                  maxInten = 10000, dye = "Cy5")</span></span>
<span><span class="co"># fluor(chan4)</span></span>
<span><span class="co"># # change 4 channel TIFF to RGB</span></span>
<span><span class="co"># chan4 &lt;- recolor(chan4)</span></span>
<span><span class="co"># showImage(chan4)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="future-directions">Future Directions<a class="anchor" aria-label="anchor" href="#future-directions"></a>
</h2>
<p>In future releases of <code>SpatialOmicsOverlay</code>, we will
be:</p>
<ol style="list-style-type: decimal">
<li>Ensuring capability with NanoString’s <a href="https://nanostring.com/products/cosmx-spatial-molecular-imager/" class="external-link">CosMx
Spatial Molecular Imager</a> outputs.</li>
<li>Adding ability to add graphing features on top of the image.</li>
<li>Adding image analysis capabilities.</li>
<li>Adding extraction of image data to use in ML/AI applications.</li>
</ol>
<p>For your reference:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sessionInfo()</span></span></code></pre></div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>NanoString Technologies, Inc.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Maddy Griswold.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
